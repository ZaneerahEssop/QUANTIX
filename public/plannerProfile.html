<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Planner Profile Details</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="profile-container">
      <h1>Set Up Your <span class="accent-text">Planner</span> Profile</h1>
      <p>Fill out your details to get started and connect with vendors.</p>

      <form class="profile-form" action="#" method="POST">
        <div class="form-group profile-pic-group">
          <div class="pic-preview">
            <i class="fas fa-camera default-icon"></i>
          </div>
          <label for="profile_pic" id="profile_pic_label"
            >Upload Profile Picture</label
          >
          <input
            type="file"
            id="profile_pic"
            name="profile_pic"
            accept="image/*"
          />
        </div>

        <div class="form-group">
          <i class="form-icon fas fa-user"></i>
          <input
            type="text"
            id="full_name"
            name="full_name"
            class="form-input"
            placeholder=" "
            required
          />
          <label for="full_name" class="form-label">Full Name</label>
        </div>

        <div class="form-group">
          <i class="form-icon fas fa-building"></i>
          <input
            type="text"
            id="company_name"
            name="company_name"
            class="form-input"
            placeholder=" "
          />
          <label for="company_name" class="form-label"
            >Company Name (Optional)</label
          >
        </div>

        <div class="form-group">
          <i class="form-icon fas fa-phone"></i>
          <input
            type="tel"
            id="phone"
            name="phone"
            class="form-input"
            placeholder=" "
            required
          />
          <label for="phone" class="form-label">Phone Number</label>
        </div>

        <div class="form-group">
          <i class="form-icon fas fa-link"></i>
          <input
            type="url"
            id="website"
            name="website"
            class="form-input"
            placeholder=" "
          />
          <label for="website" class="form-label">Website / Portfolio</label>
        </div>

        <div class="form-group">
          <i class="form-icon fas fa-align-left"></i>
          <textarea
            id="bio"
            name="bio"
            class="form-input"
            placeholder=" "
          ></textarea>
          <label for="bio" class="form-label">Short Bio</label>
        </div>

        <button type="submit" class="submit-btn">Save & Continue</button>
      </form>
    </main>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
      import {
        getStorage,
        ref,
        uploadBytes,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-storage.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCwoCgB9o8JCGJltFfMCVb0EqRxRWSODZ0",
        authDomain: "quantix-26ba5.firebaseapp.com",
        projectId: "quantix-26ba5",
        storageBucket: "quantix-26ba5.firebasestorage.app",
        messagingSenderId: "503362009947",
        appId: "1:503362009947:web:67ef295f8cd987cc55787e",
        measurementId: "G-HJB25H1SWR",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const storage = getStorage(app);

      const plannerForm = document.querySelector(".profile-form");

      plannerForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const fullName = document.getElementById("full_name").value;
        const companyName = document.getElementById("company_name").value;
        const phone = document.getElementById("phone").value;
        const website = document.getElementById("website").value;
        const bio = document.getElementById("bio").value;
        const file = document.getElementById("profile_pic").files[0];

        let photoURL = "";
        if (file) {
          const storageRef = ref(
            storage,
            `planner_photos/${Date.now()}_${file.name}`
          );
          await uploadBytes(storageRef, file);
          photoURL = await getDownloadURL(storageRef);
        }

        await addDoc(collection(db, "planners"), {
          fullName,
          companyName,
          phoneNumber: phone,
          website,
          bio,
          photoURL,
          createdAt: new Date(),
        });

        alert("Planner profile saved successfully!");
        plannerForm.reset();
      });
    </script>

    <script>
      // --- Live Profile Picture Preview ---
      document
        .getElementById("profile_pic")
        .addEventListener("change", function () {
          const file = this.files[0];
          if (file) {
            const picPreview = document.querySelector(".pic-preview");
            picPreview.style.backgroundImage = `url(${URL.createObjectURL(
              file
            )})`;
            picPreview.querySelector(".default-icon").style.display = "none";
          }
        });

      // --- Logic for Floating Labels ---
      document.querySelectorAll(".form-input").forEach((input) => {
        // Check on blur (clicking away)
        input.addEventListener("blur", function () {
          if (this.value) {
            this.classList.add("has-value");
          } else {
            this.classList.remove("has-value");
          }
        });
        // Check on page load in case of browser auto-fill
        if (input.value) {
          input.classList.add("has-value");
        }
      });
    </script>
  </body>
</html>
