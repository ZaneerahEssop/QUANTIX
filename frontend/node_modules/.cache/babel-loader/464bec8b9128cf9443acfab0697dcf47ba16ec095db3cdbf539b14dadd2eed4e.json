{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Ammaarah\\\\EventuallyPerfect\\\\QUANTIX\\\\frontend\\\\src\\\\pages\\\\LoginPage.jsx\",\n  _s = $RefreshSig$();\n// src/pages/LoginPage.jsx\nimport React, { useEffect, useState } from \"react\";\nimport { supabase } from \"../client\";\nimport { useNavigate, Link } from \"react-router-dom\";\nimport { OAUTH_REDIRECT_URL } from \"../config\";\nimport \"../App.css\";\nimport \"../AuthPages.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction LoginPage() {\n  _s();\n  const [session, setSession] = useState(null);\n  const navigate = useNavigate();\n  useEffect(() => {\n    supabase.auth.getSession().then(({\n      data: {\n        session\n      }\n    }) => {\n      setSession(session);\n    });\n    const {\n      data: {\n        subscription\n      }\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      setSession(session);\n    });\n    return () => subscription.unsubscribe();\n  }, []);\n  const [loginError, setLoginError] = useState(\"\");\n  useEffect(() => {\n    async function redirectByRole() {\n      if (session && session.user) {\n        const {\n          data,\n          error\n        } = await supabase.from('users').select('user_role').eq('user_id', session.user.id).single();\n        if (error || !data) {\n          setLoginError(\"Account not found. Please sign up first.\");\n          return;\n        }\n        if (data.user_role === 'planner') navigate('/dashboard');else if (data.user_role === 'vendor') {\n          // fetch vendor status\n          const {\n            data: vendor,\n            error: vendorError\n          } = await supabase.from(\"vendors\").select(\"status\").eq(\"vendor_id\", session.user.id).single();\n          if (vendorError || !vendor) {\n            console.error(\"Error fetching vendor status:\", vendorError === null || vendorError === void 0 ? void 0 : vendorError.message);\n            navigate(\"/pending-approval\", {\n              state: {\n                status: \"pending\"\n              }\n            }); // fallback\n            return;\n          } else if (vendor.status === \"accepted\") {\n            navigate(\"/vendor-dashboard\");\n          } else if (vendor.status === \"pending\") {\n            navigate(\"/pending-approval\", {\n              state: {\n                status: \"pending\"\n              }\n            });\n          } else if (vendor.status === \"rejected\") {\n            navigate(\"/pending-approval\", {\n              state: {\n                status: \"rejected\"\n              }\n            });\n          } else {\n            // unknown status fallback\n            navigate(\"/pending-approval\", {\n              state: {\n                status: \"pending\"\n              }\n            });\n          }\n        } else if (data.user_role === 'admin') navigate('/admin-dashboard');else navigate('/dashboard');\n      }\n    }\n    redirectByRole();\n  }, [session, navigate]);\n  const handleGoogleSignIn = async () => {\n    // Always use localhost for development\n    const redirectUrl = window.location.hostname === 'localhost' ? 'http://localhost:3000/loading' : OAUTH_REDIRECT_URL;\n    console.log('Initiating Google OAuth with redirect URL:', redirectUrl);\n    try {\n      const {\n        data,\n        error\n      } = await supabase.auth.signInWithOAuth({\n        provider: 'google',\n        options: {\n          redirectTo: redirectUrl,\n          queryParams: {\n            access_type: 'offline',\n            prompt: 'consent'\n          },\n          skipBrowserRedirect: false // Ensure the browser handles the redirect\n        }\n      });\n      if (error) {\n        console.error('Error with Google sign-in:', error);\n        // Handle error (show to user)\n        return;\n      }\n      console.log('OAuth response:', data);\n    } catch (err) {\n      console.error('Unexpected error during sign in:', err);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"auth-bg\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"auth-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: [\"Welcome to \", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"accent-text\",\n          children: \"Event-ually Perfect\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 22\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Login to get started planning or managing your event experience.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleGoogleSignIn,\n        className: \"auth-btn\",\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"fab fa-google\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 11\n        }, this), \" Login with Google\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this), loginError && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: \"pink\",\n          marginBottom: \"1rem\"\n        },\n        children: loginError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"auth-prompt\",\n        children: [\"First time?\", ' ', /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/signup\",\n          className: \"auth-link\",\n          children: \"Sign up here\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 5\n  }, this);\n}\n_s(LoginPage, \"QN54vYQvlI8e/LcZg03oNozMuEM=\", false, function () {\n  return [useNavigate];\n});\n_c = LoginPage;\nexport default LoginPage;\nvar _c;\n$RefreshReg$(_c, \"LoginPage\");","map":{"version":3,"names":["React","useEffect","useState","supabase","useNavigate","Link","OAUTH_REDIRECT_URL","jsxDEV","_jsxDEV","LoginPage","_s","session","setSession","navigate","auth","getSession","then","data","subscription","onAuthStateChange","_event","unsubscribe","loginError","setLoginError","redirectByRole","user","error","from","select","eq","id","single","user_role","vendor","vendorError","console","message","state","status","handleGoogleSignIn","redirectUrl","window","location","hostname","log","signInWithOAuth","provider","options","redirectTo","queryParams","access_type","prompt","skipBrowserRedirect","err","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","style","color","marginBottom","to","_c","$RefreshReg$"],"sources":["C:/Users/Ammaarah/EventuallyPerfect/QUANTIX/frontend/src/pages/LoginPage.jsx"],"sourcesContent":["// src/pages/LoginPage.jsx\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { supabase } from \"../client\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\nimport { OAUTH_REDIRECT_URL } from \"../config\";\r\nimport \"../App.css\";\r\nimport \"../AuthPages.css\";\r\n\r\nfunction LoginPage() {\r\n  const [session, setSession] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    \r\n    supabase.auth.getSession().then(({ data: { session } }) => {\r\n      setSession(session);\r\n    });\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {\r\n      setSession(session);\r\n    });\r\n    return () => subscription.unsubscribe();\r\n  }, []);\r\n\r\nconst [loginError, setLoginError] = useState(\"\");\r\n\r\nuseEffect(() => {\r\n  async function redirectByRole() {\r\n    if (session && session.user) {\r\n      const { data, error } = await supabase\r\n        .from('users')\r\n        .select('user_role')\r\n        .eq('user_id', session.user.id)\r\n        .single();\r\n      if (error || !data) {\r\n        setLoginError(\"Account not found. Please sign up first.\");\r\n        return;\r\n      }\r\n      if (data.user_role === 'planner') navigate('/dashboard');\r\n      else if (data.user_role === 'vendor') {\r\n        // fetch vendor status\r\n        const { data: vendor, error: vendorError } = await supabase\r\n          .from(\"vendors\")\r\n          .select(\"status\")\r\n          .eq(\"vendor_id\", session.user.id)\r\n          .single();\r\n\r\n        if (vendorError || !vendor) {\r\n            console.error(\"Error fetching vendor status:\", vendorError?.message);\r\n            navigate(\"/pending-approval\", { state: { status: \"pending\" } }); // fallback\r\n            return;\r\n        }else if (vendor.status === \"accepted\") {\r\n            navigate(\"/vendor-dashboard\");\r\n        } else if (vendor.status === \"pending\") {\r\n            navigate(\"/pending-approval\", { state: { status: \"pending\" } });\r\n        } else if (vendor.status === \"rejected\") {\r\n            navigate(\"/pending-approval\", { state: { status: \"rejected\" } });\r\n        } else {\r\n            // unknown status fallback\r\n            navigate(\"/pending-approval\", { state: { status: \"pending\" } });\r\n          }\r\n      }\r\n\r\n      else if (data.user_role === 'admin') navigate('/admin-dashboard');\r\n      else navigate('/dashboard');\r\n    }\r\n  }\r\n  redirectByRole();\r\n}, [session, navigate]);\r\n\r\n  const handleGoogleSignIn = async () => {\r\n    // Always use localhost for development\r\n    const redirectUrl = window.location.hostname === 'localhost' \r\n      ? 'http://localhost:3000/loading'\r\n      : OAUTH_REDIRECT_URL;\r\n      \r\n    console.log('Initiating Google OAuth with redirect URL:', redirectUrl);\r\n    \r\n    try {\r\n      const { data, error } = await supabase.auth.signInWithOAuth({\r\n        provider: 'google',\r\n        options: {\r\n          redirectTo: redirectUrl,\r\n          queryParams: {\r\n            access_type: 'offline',\r\n            prompt: 'consent',\r\n          },\r\n          skipBrowserRedirect: false // Ensure the browser handles the redirect\r\n        }\r\n      });\r\n      \r\n      if (error) {\r\n        console.error('Error with Google sign-in:', error);\r\n        // Handle error (show to user)\r\n        return;\r\n      }\r\n      \r\n      console.log('OAuth response:', data);\r\n      \r\n    } catch (err) {\r\n      console.error('Unexpected error during sign in:', err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"auth-bg\">\r\n      <div className=\"auth-container\">\r\n        <h1>\r\n          Welcome to <span className=\"accent-text\">Event-ually Perfect</span>\r\n        </h1>\r\n        <p>Login to get started planning or managing your event experience.</p>\r\n        <button onClick={handleGoogleSignIn} className=\"auth-btn\">\r\n          <i className=\"fab fa-google\"></i> Login with Google\r\n        </button>\r\n         {loginError && (\r\n        <div style={{ color: \"pink\", marginBottom: \"1rem\" }}>\r\n          {loginError}\r\n        </div>\r\n      )}\r\n        <p className=\"auth-prompt\">\r\n          First time?{' '}\r\n          <Link to=\"/signup\" className=\"auth-link\">\r\n            Sign up here\r\n          </Link>\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LoginPage;"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,SAASC,QAAQ,QAAQ,WAAW;AACpC,SAASC,WAAW,EAAEC,IAAI,QAAQ,kBAAkB;AACpD,SAASC,kBAAkB,QAAQ,WAAW;AAC9C,OAAO,YAAY;AACnB,OAAO,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE1B,SAASC,SAASA,CAAA,EAAG;EAAAC,EAAA;EACnB,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGV,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAMW,QAAQ,GAAGT,WAAW,CAAC,CAAC;EAE9BH,SAAS,CAAC,MAAM;IAEdE,QAAQ,CAACW,IAAI,CAACC,UAAU,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC;MAAEC,IAAI,EAAE;QAAEN;MAAQ;IAAE,CAAC,KAAK;MACzDC,UAAU,CAACD,OAAO,CAAC;IACrB,CAAC,CAAC;IACF,MAAM;MAAEM,IAAI,EAAE;QAAEC;MAAa;IAAE,CAAC,GAAGf,QAAQ,CAACW,IAAI,CAACK,iBAAiB,CAAC,CAACC,MAAM,EAAET,OAAO,KAAK;MACtFC,UAAU,CAACD,OAAO,CAAC;IACrB,CAAC,CAAC;IACF,OAAO,MAAMO,YAAY,CAACG,WAAW,CAAC,CAAC;EACzC,CAAC,EAAE,EAAE,CAAC;EAER,MAAM,CAACC,UAAU,EAAEC,aAAa,CAAC,GAAGrB,QAAQ,CAAC,EAAE,CAAC;EAEhDD,SAAS,CAAC,MAAM;IACd,eAAeuB,cAAcA,CAAA,EAAG;MAC9B,IAAIb,OAAO,IAAIA,OAAO,CAACc,IAAI,EAAE;QAC3B,MAAM;UAAER,IAAI;UAAES;QAAM,CAAC,GAAG,MAAMvB,QAAQ,CACnCwB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,WAAW,CAAC,CACnBC,EAAE,CAAC,SAAS,EAAElB,OAAO,CAACc,IAAI,CAACK,EAAE,CAAC,CAC9BC,MAAM,CAAC,CAAC;QACX,IAAIL,KAAK,IAAI,CAACT,IAAI,EAAE;UAClBM,aAAa,CAAC,0CAA0C,CAAC;UACzD;QACF;QACA,IAAIN,IAAI,CAACe,SAAS,KAAK,SAAS,EAAEnB,QAAQ,CAAC,YAAY,CAAC,CAAC,KACpD,IAAII,IAAI,CAACe,SAAS,KAAK,QAAQ,EAAE;UACpC;UACA,MAAM;YAAEf,IAAI,EAAEgB,MAAM;YAAEP,KAAK,EAAEQ;UAAY,CAAC,GAAG,MAAM/B,QAAQ,CACxDwB,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,QAAQ,CAAC,CAChBC,EAAE,CAAC,WAAW,EAAElB,OAAO,CAACc,IAAI,CAACK,EAAE,CAAC,CAChCC,MAAM,CAAC,CAAC;UAEX,IAAIG,WAAW,IAAI,CAACD,MAAM,EAAE;YACxBE,OAAO,CAACT,KAAK,CAAC,+BAA+B,EAAEQ,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEE,OAAO,CAAC;YACpEvB,QAAQ,CAAC,mBAAmB,EAAE;cAAEwB,KAAK,EAAE;gBAAEC,MAAM,EAAE;cAAU;YAAE,CAAC,CAAC,CAAC,CAAC;YACjE;UACJ,CAAC,MAAK,IAAIL,MAAM,CAACK,MAAM,KAAK,UAAU,EAAE;YACpCzB,QAAQ,CAAC,mBAAmB,CAAC;UACjC,CAAC,MAAM,IAAIoB,MAAM,CAACK,MAAM,KAAK,SAAS,EAAE;YACpCzB,QAAQ,CAAC,mBAAmB,EAAE;cAAEwB,KAAK,EAAE;gBAAEC,MAAM,EAAE;cAAU;YAAE,CAAC,CAAC;UACnE,CAAC,MAAM,IAAIL,MAAM,CAACK,MAAM,KAAK,UAAU,EAAE;YACrCzB,QAAQ,CAAC,mBAAmB,EAAE;cAAEwB,KAAK,EAAE;gBAAEC,MAAM,EAAE;cAAW;YAAE,CAAC,CAAC;UACpE,CAAC,MAAM;YACH;YACAzB,QAAQ,CAAC,mBAAmB,EAAE;cAAEwB,KAAK,EAAE;gBAAEC,MAAM,EAAE;cAAU;YAAE,CAAC,CAAC;UACjE;QACJ,CAAC,MAEI,IAAIrB,IAAI,CAACe,SAAS,KAAK,OAAO,EAAEnB,QAAQ,CAAC,kBAAkB,CAAC,CAAC,KAC7DA,QAAQ,CAAC,YAAY,CAAC;MAC7B;IACF;IACAW,cAAc,CAAC,CAAC;EAClB,CAAC,EAAE,CAACb,OAAO,EAAEE,QAAQ,CAAC,CAAC;EAErB,MAAM0B,kBAAkB,GAAG,MAAAA,CAAA,KAAY;IACrC;IACA,MAAMC,WAAW,GAAGC,MAAM,CAACC,QAAQ,CAACC,QAAQ,KAAK,WAAW,GACxD,+BAA+B,GAC/BrC,kBAAkB;IAEtB6B,OAAO,CAACS,GAAG,CAAC,4CAA4C,EAAEJ,WAAW,CAAC;IAEtE,IAAI;MACF,MAAM;QAAEvB,IAAI;QAAES;MAAM,CAAC,GAAG,MAAMvB,QAAQ,CAACW,IAAI,CAAC+B,eAAe,CAAC;QAC1DC,QAAQ,EAAE,QAAQ;QAClBC,OAAO,EAAE;UACPC,UAAU,EAAER,WAAW;UACvBS,WAAW,EAAE;YACXC,WAAW,EAAE,SAAS;YACtBC,MAAM,EAAE;UACV,CAAC;UACDC,mBAAmB,EAAE,KAAK,CAAC;QAC7B;MACF,CAAC,CAAC;MAEF,IAAI1B,KAAK,EAAE;QACTS,OAAO,CAACT,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;QAClD;QACA;MACF;MAEAS,OAAO,CAACS,GAAG,CAAC,iBAAiB,EAAE3B,IAAI,CAAC;IAEtC,CAAC,CAAC,OAAOoC,GAAG,EAAE;MACZlB,OAAO,CAACT,KAAK,CAAC,kCAAkC,EAAE2B,GAAG,CAAC;IACxD;EACF,CAAC;EAED,oBACE7C,OAAA;IAAK8C,SAAS,EAAC,SAAS;IAAAC,QAAA,eACtB/C,OAAA;MAAK8C,SAAS,EAAC,gBAAgB;MAAAC,QAAA,gBAC7B/C,OAAA;QAAA+C,QAAA,GAAI,aACS,eAAA/C,OAAA;UAAM8C,SAAS,EAAC,aAAa;UAAAC,QAAA,EAAC;QAAmB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACjE,CAAC,eACLnD,OAAA;QAAA+C,QAAA,EAAG;MAAgE;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC,eACvEnD,OAAA;QAAQoD,OAAO,EAAErB,kBAAmB;QAACe,SAAS,EAAC,UAAU;QAAAC,QAAA,gBACvD/C,OAAA;UAAG8C,SAAS,EAAC;QAAe;UAAAE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,sBACnC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,EACPrC,UAAU,iBACZd,OAAA;QAAKqD,KAAK,EAAE;UAAEC,KAAK,EAAE,MAAM;UAAEC,YAAY,EAAE;QAAO,CAAE;QAAAR,QAAA,EACjDjC;MAAU;QAAAkC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACR,CACN,eACCnD,OAAA;QAAG8C,SAAS,EAAC,aAAa;QAAAC,QAAA,GAAC,aACd,EAAC,GAAG,eACf/C,OAAA,CAACH,IAAI;UAAC2D,EAAE,EAAC,SAAS;UAACV,SAAS,EAAC,WAAW;UAAAC,QAAA,EAAC;QAEzC;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACD;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAACjD,EAAA,CAvHQD,SAAS;EAAA,QAECL,WAAW;AAAA;AAAA6D,EAAA,GAFrBxD,SAAS;AAyHlB,eAAeA,SAAS;AAAC,IAAAwD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}