{"ast":null,"code":"import React,{useEffect}from'react';import{useNavigate,useLocation}from'react-router-dom';import{supabase}from'../client';import'../App.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function LoadingPage(){const navigate=useNavigate();const location=useLocation();useEffect(()=>{const handleOAuthCallback=async()=>{try{// Handle OAuth callback if this is a redirect from OAuth\nconst{data:{session},error}=await supabase.auth.getSession();if(error)throw error;if(!session){navigate('/login');return;}// Check if this is a new signup by looking for the role in sessionStorage\nconst signupRole=sessionStorage.getItem('signupRole');if(signupRole){// If this is a new signup, redirect to post-signup flow\nnavigate('/post-signup');return;}// For existing users, fetch their role and redirect accordingly\nconst{data:userData,error:roleError}=await supabase.from('users').select('user_role').eq('user_id',session.user.id).single();if(roleError||!userData){console.error('Error fetching user role:',(roleError===null||roleError===void 0?void 0:roleError.message)||'No role found');navigate('/login');return;}// Redirect based on role for existing users\nif(userData.user_role==='planner'){navigate('/dashboard');}else if(userData.user_role==='vendor'){// Fetch vendor status before deciding\nconst{data:vendor,error:vendorError}=await supabase.from(\"vendors\").select(\"status\").eq(\"vendor_id\",session.user.id).single();if(vendorError||!vendor){console.error(\"Error fetching vendor status:\",vendorError===null||vendorError===void 0?void 0:vendorError.message);navigate(\"/pending-approval\");return;}if(vendor.status===\"accepted\"){navigate(\"/vendor-dashboard\");}else if(vendor.status===\"pending\"){navigate(\"/pending-approval\");}else if(vendor.status===\"rejected\"){navigate(\"/pending-approval\",{state:{status:\"rejected\"}});}else{navigate(\"/pending-approval\");}}else if(userData.user_role==='admin'){navigate('/admin-dashboard');}else{console.error('Unknown role:',userData.user_role);navigate('/login');}}catch(error){console.error('Error in loading page:',error.message);navigate('/login');}};handleOAuthCallback();},[navigate,location]);return/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading your dashboard...\"})]});}export default LoadingPage;","map":{"version":3,"names":["React","useEffect","useNavigate","useLocation","supabase","jsx","_jsx","jsxs","_jsxs","LoadingPage","navigate","location","handleOAuthCallback","data","session","error","auth","getSession","signupRole","sessionStorage","getItem","userData","roleError","from","select","eq","user","id","single","console","message","user_role","vendor","vendorError","status","state","className","children"],"sources":["C:/Users/Ammaarah/EventuallyPerfect/QUANTIX/frontend/src/pages/LoadingPage.jsx"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { supabase } from '../client';\r\nimport '../App.css';\r\n\r\nfunction LoadingPage() {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  useEffect(() => {\r\n    const handleOAuthCallback = async () => {\r\n      try {\r\n        // Handle OAuth callback if this is a redirect from OAuth\r\n        const { data: { session }, error } = await supabase.auth.getSession();\r\n        \r\n        if (error) throw error;\r\n        \r\n        if (!session) {\r\n          navigate('/login');\r\n          return;\r\n        }\r\n\r\n        // Check if this is a new signup by looking for the role in sessionStorage\r\n        const signupRole = sessionStorage.getItem('signupRole');\r\n        \r\n        if (signupRole) {\r\n          // If this is a new signup, redirect to post-signup flow\r\n          navigate('/post-signup');\r\n          return;\r\n        }\r\n\r\n        // For existing users, fetch their role and redirect accordingly\r\n        const { data: userData, error: roleError } = await supabase\r\n          .from('users')\r\n          .select('user_role')\r\n          .eq('user_id', session.user.id)\r\n          .single();\r\n\r\n        if (roleError || !userData) {\r\n          console.error('Error fetching user role:', roleError?.message || 'No role found');\r\n          navigate('/login');\r\n          return;\r\n        }\r\n\r\n        // Redirect based on role for existing users\r\n        if (userData.user_role === 'planner') {\r\n          navigate('/dashboard');\r\n        } else if (userData.user_role === 'vendor') {\r\n          // Fetch vendor status before deciding\r\n          const { data: vendor, error: vendorError } = await supabase\r\n            .from(\"vendors\")\r\n            .select(\"status\")\r\n            .eq(\"vendor_id\", session.user.id)\r\n            .single();\r\n\r\n          if (vendorError || !vendor) {\r\n            console.error(\"Error fetching vendor status:\", vendorError?.message);\r\n            navigate(\"/pending-approval\");\r\n            return;\r\n          }\r\n\r\n          if (vendor.status === \"accepted\") {\r\n            navigate(\"/vendor-dashboard\");\r\n          } else if (vendor.status === \"pending\") {\r\n            navigate(\"/pending-approval\");\r\n          } else if (vendor.status === \"rejected\") {\r\n            navigate(\"/pending-approval\", { state: { status: \"rejected\" } });\r\n          } else {\r\n            navigate(\"/pending-approval\");\r\n          }\r\n        } else if (userData.user_role === 'admin') {\r\n          navigate('/admin-dashboard');\r\n        } else {\r\n          console.error('Unknown role:', userData.user_role);\r\n          navigate('/login');\r\n        }\r\n      } catch (error) {\r\n        console.error('Error in loading page:', error.message);\r\n        navigate('/login');\r\n      }\r\n    };\r\n\r\n    handleOAuthCallback();\r\n  }, [navigate, location]);\r\n\r\n  return (\r\n    <div className=\"loading-container\">\r\n      <div className=\"loading-spinner\"></div>\r\n      <p>Loading your dashboard...</p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LoadingPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}