{"ast":null,"code":"// src/pages/LoginPage.jsx\nimport React,{useEffect,useState}from\"react\";import{supabase}from\"../client\";import{useNavigate,Link}from\"react-router-dom\";import{OAUTH_REDIRECT_URL}from\"../config\";import\"../App.css\";import\"../AuthPages.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function LoginPage(){const[session,setSession]=useState(null);const navigate=useNavigate();useEffect(()=>{supabase.auth.getSession().then(_ref=>{let{data:{session}}=_ref;setSession(session);});const{data:{subscription}}=supabase.auth.onAuthStateChange((_event,session)=>{setSession(session);});return()=>subscription.unsubscribe();},[]);const[loginError,setLoginError]=useState(\"\");useEffect(()=>{async function redirectByRole(){if(session&&session.user){const{data,error}=await supabase.from('users').select('user_role').eq('user_id',session.user.id).single();if(error||!data){setLoginError(\"Account not found. Please sign up first.\");return;}if(data.user_role==='planner')navigate('/dashboard');else if(data.user_role==='vendor'){// fetch vendor status\nconst{data:vendor,error:vendorError}=await supabase.from(\"vendors\").select(\"status\").eq(\"vendor_id\",session.user.id).single();if(vendorError||!vendor){console.error(\"Error fetching vendor status:\",vendorError===null||vendorError===void 0?void 0:vendorError.message);navigate(\"/pending-approval\",{state:{status:\"pending\"}});// fallback\nreturn;}else if(vendor.status===\"accepted\"){navigate(\"/vendor-dashboard\");}else if(vendor.status===\"pending\"){navigate(\"/pending-approval\",{state:{status:\"pending\"}});}else if(vendor.status===\"rejected\"){navigate(\"/pending-approval\",{state:{status:\"rejected\"}});}else{// unknown status fallback\nnavigate(\"/pending-approval\",{state:{status:\"pending\"}});}}else if(data.user_role==='admin')navigate('/admin-dashboard');else navigate('/dashboard');}}redirectByRole();},[session,navigate]);const handleGoogleSignIn=async()=>{// Always use localhost for development\nconst redirectUrl=window.location.hostname==='localhost'?'http://localhost:3000/loading':OAUTH_REDIRECT_URL;console.log('Initiating Google OAuth with redirect URL:',redirectUrl);try{const{data,error}=await supabase.auth.signInWithOAuth({provider:'google',options:{redirectTo:redirectUrl,queryParams:{access_type:'offline',prompt:'consent'},skipBrowserRedirect:false// Ensure the browser handles the redirect\n}});if(error){console.error('Error with Google sign-in:',error);// Handle error (show to user)\nreturn;}console.log('OAuth response:',data);}catch(err){console.error('Unexpected error during sign in:',err);}};return/*#__PURE__*/_jsx(\"div\",{className:\"auth-bg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"auth-container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Welcome to \",/*#__PURE__*/_jsx(\"span\",{className:\"accent-text\",children:\"Event-ually Perfect\"})]}),/*#__PURE__*/_jsx(\"p\",{children:\"Login to get started planning or managing your event experience.\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleGoogleSignIn,className:\"auth-btn\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fab fa-google\"}),\" Login with Google\"]}),loginError&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"pink\",marginBottom:\"1rem\"},children:loginError}),/*#__PURE__*/_jsxs(\"p\",{className:\"auth-prompt\",children:[\"First time?\",' ',/*#__PURE__*/_jsx(Link,{to:\"/signup\",className:\"auth-link\",children:\"Sign up here\"})]})]})});}export default LoginPage;","map":{"version":3,"names":["React","useEffect","useState","supabase","useNavigate","Link","OAUTH_REDIRECT_URL","jsx","_jsx","jsxs","_jsxs","LoginPage","session","setSession","navigate","auth","getSession","then","_ref","data","subscription","onAuthStateChange","_event","unsubscribe","loginError","setLoginError","redirectByRole","user","error","from","select","eq","id","single","user_role","vendor","vendorError","console","message","state","status","handleGoogleSignIn","redirectUrl","window","location","hostname","log","signInWithOAuth","provider","options","redirectTo","queryParams","access_type","prompt","skipBrowserRedirect","err","className","children","onClick","style","color","marginBottom","to"],"sources":["C:/Users/Ammaarah/EventuallyPerfect/QUANTIX/frontend/src/pages/LoginPage.jsx"],"sourcesContent":["// src/pages/LoginPage.jsx\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { supabase } from \"../client\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\nimport { OAUTH_REDIRECT_URL } from \"../config\";\r\nimport \"../App.css\";\r\nimport \"../AuthPages.css\";\r\n\r\nfunction LoginPage() {\r\n  const [session, setSession] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    \r\n    supabase.auth.getSession().then(({ data: { session } }) => {\r\n      setSession(session);\r\n    });\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {\r\n      setSession(session);\r\n    });\r\n    return () => subscription.unsubscribe();\r\n  }, []);\r\n\r\nconst [loginError, setLoginError] = useState(\"\");\r\n\r\nuseEffect(() => {\r\n  async function redirectByRole() {\r\n    if (session && session.user) {\r\n      const { data, error } = await supabase\r\n        .from('users')\r\n        .select('user_role')\r\n        .eq('user_id', session.user.id)\r\n        .single();\r\n      if (error || !data) {\r\n        setLoginError(\"Account not found. Please sign up first.\");\r\n        return;\r\n      }\r\n      if (data.user_role === 'planner') navigate('/dashboard');\r\n      else if (data.user_role === 'vendor') {\r\n        // fetch vendor status\r\n        const { data: vendor, error: vendorError } = await supabase\r\n          .from(\"vendors\")\r\n          .select(\"status\")\r\n          .eq(\"vendor_id\", session.user.id)\r\n          .single();\r\n\r\n        if (vendorError || !vendor) {\r\n            console.error(\"Error fetching vendor status:\", vendorError?.message);\r\n            navigate(\"/pending-approval\", { state: { status: \"pending\" } }); // fallback\r\n            return;\r\n        }else if (vendor.status === \"accepted\") {\r\n            navigate(\"/vendor-dashboard\");\r\n        } else if (vendor.status === \"pending\") {\r\n            navigate(\"/pending-approval\", { state: { status: \"pending\" } });\r\n        } else if (vendor.status === \"rejected\") {\r\n            navigate(\"/pending-approval\", { state: { status: \"rejected\" } });\r\n        } else {\r\n            // unknown status fallback\r\n            navigate(\"/pending-approval\", { state: { status: \"pending\" } });\r\n          }\r\n      }\r\n\r\n      else if (data.user_role === 'admin') navigate('/admin-dashboard');\r\n      else navigate('/dashboard');\r\n    }\r\n  }\r\n  redirectByRole();\r\n}, [session, navigate]);\r\n\r\n  const handleGoogleSignIn = async () => {\r\n    // Always use localhost for development\r\n    const redirectUrl = window.location.hostname === 'localhost' \r\n      ? 'http://localhost:3000/loading'\r\n      : OAUTH_REDIRECT_URL;\r\n      \r\n    console.log('Initiating Google OAuth with redirect URL:', redirectUrl);\r\n    \r\n    try {\r\n      const { data, error } = await supabase.auth.signInWithOAuth({\r\n        provider: 'google',\r\n        options: {\r\n          redirectTo: redirectUrl,\r\n          queryParams: {\r\n            access_type: 'offline',\r\n            prompt: 'consent',\r\n          },\r\n          skipBrowserRedirect: false // Ensure the browser handles the redirect\r\n        }\r\n      });\r\n      \r\n      if (error) {\r\n        console.error('Error with Google sign-in:', error);\r\n        // Handle error (show to user)\r\n        return;\r\n      }\r\n      \r\n      console.log('OAuth response:', data);\r\n      \r\n    } catch (err) {\r\n      console.error('Unexpected error during sign in:', err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"auth-bg\">\r\n      <div className=\"auth-container\">\r\n        <h1>\r\n          Welcome to <span className=\"accent-text\">Event-ually Perfect</span>\r\n        </h1>\r\n        <p>Login to get started planning or managing your event experience.</p>\r\n        <button onClick={handleGoogleSignIn} className=\"auth-btn\">\r\n          <i className=\"fab fa-google\"></i> Login with Google\r\n        </button>\r\n         {loginError && (\r\n        <div style={{ color: \"pink\", marginBottom: \"1rem\" }}>\r\n          {loginError}\r\n        </div>\r\n      )}\r\n        <p className=\"auth-prompt\">\r\n          First time?{' '}\r\n          <Link to=\"/signup\" className=\"auth-link\">\r\n            Sign up here\r\n          </Link>\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LoginPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}