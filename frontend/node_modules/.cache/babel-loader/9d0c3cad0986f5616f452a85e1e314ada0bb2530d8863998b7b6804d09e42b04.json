{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Ammaarah\\\\EventuallyPerfect\\\\QUANTIX\\\\frontend\\\\src\\\\components\\\\services\\\\PhotographyService.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { supabase } from '../../client';\nimport { FaCheckCircle, FaTimesCircle, FaInfoCircle } from 'react-icons/fa';\nimport './PhotographyService.css';\n\n// Text editor with formatting options\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SimpleTextEditor = ({\n  value,\n  onChange,\n  placeholder,\n  height = '150px'\n}) => {\n  _s();\n  const textareaRef = useRef(null);\n\n  // Handle text changes\n  const handleChange = e => {\n    onChange(e.target.value);\n  };\n\n  // Handle tab key for indentation\n  const handleKeyDown = e => {\n    const textarea = e.target;\n    const start = textarea.selectionStart;\n    const end = textarea.selectionEnd;\n    if (e.key === 'Tab') {\n      e.preventDefault();\n      if (e.shiftKey) {\n        // Handle Shift+Tab to decrease indentation\n        const beforeCursor = value.substring(0, start);\n        const lineStart = beforeCursor.lastIndexOf('\\n') + 1;\n        const line = value.substring(lineStart, start);\n        if (line.startsWith('  ') || line.startsWith('\\t')) {\n          // Remove one level of indentation (tab or 2 spaces)\n          const newValue = value.substring(0, lineStart) + line.replace(/^(\\s{1,2}|\\t)/, '') + value.substring(start);\n          const newPos = start - 1;\n          onChange(newValue);\n          setTimeout(() => {\n            textarea.selectionStart = textarea.selectionEnd = Math.max(lineStart, newPos);\n          }, 0);\n        }\n      } else {\n        // Handle Tab to increase indentation\n        const newValue = value.substring(0, start) + '  ' + value.substring(end);\n        onChange(newValue);\n\n        // Move cursor after the indentation\n        setTimeout(() => {\n          textarea.selectionStart = textarea.selectionEnd = start + 2;\n        }, 0);\n      }\n    } else if (e.key === 'Enter') {\n      // Handle Enter key to maintain list indentation\n      const beforeCursor = value.substring(0, start);\n      const lineStart = beforeCursor.lastIndexOf('\\n') + 1;\n      const line = value.substring(lineStart, start);\n\n      // Check if we're in a list item\n      const listMatch = line.match(/^(\\s*[-*+]\\s|\\s*\\d+\\.\\s)/);\n      if (listMatch) {\n        e.preventDefault();\n        const indent = listMatch[1] ? listMatch[0] : '';\n        const newValue = value.substring(0, start) + '\\n' + indent + value.substring(end);\n        const newPos = start + indent.length + 1;\n        onChange(newValue);\n        setTimeout(() => {\n          textarea.selectionStart = textarea.selectionEnd = newPos;\n        }, 0);\n      }\n    }\n  };\n\n  // Apply formatting to selected text\n  const applyFormat = format => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n    const start = textarea.selectionStart;\n    const end = textarea.selectionEnd;\n    const selectedText = value.substring(start, end);\n    const beforeCursor = value.substring(0, start);\n    const lineStart = beforeCursor.lastIndexOf('\\n') + 1;\n    const line = value.substring(lineStart, start);\n    const indent = line.match(/^\\s*/)[0] || '';\n    let newValue = value;\n    let newCursorPos = end;\n    switch (format) {\n      case 'bold':\n        newValue = value.substring(0, start) + `**${selectedText}**` + value.substring(end);\n        newCursorPos = selectedText ? end + 4 : start + 2;\n        break;\n      case 'bullet':\n        if (selectedText) {\n          const lines = selectedText.split('\\n').map((line, i) => {\n            if (!line.trim()) return '';\n            const lineIndent = line.match(/^\\s*/)[0];\n            return `${lineIndent}- ${line.trimStart()}`;\n          }).join('\\n');\n          newValue = value.substring(0, start) + lines + value.substring(end);\n          newCursorPos = end + (lines.length - selectedText.length);\n        } else {\n          newValue = value.substring(0, start) + `${indent}- ` + value.substring(start);\n          newCursorPos = start + indent.length + 2;\n        }\n        break;\n      case 'number':\n        if (selectedText) {\n          let itemNumber = 1;\n          const lines = selectedText.split('\\n').map((line, i) => {\n            if (!line.trim()) return '';\n            const lineIndent = line.match(/^\\s*/)[0];\n            const numbered = `${lineIndent}${itemNumber}. ${line.trimStart()}`;\n            itemNumber++;\n            return numbered;\n          }).join('\\n');\n          newValue = value.substring(0, start) + lines + value.substring(end);\n          newCursorPos = end + (lines.length - selectedText.length);\n        } else {\n          newValue = value.substring(0, start) + `${indent}1. ` + value.substring(start);\n          newCursorPos = start + indent.length + 3;\n        }\n        break;\n      default:\n        return;\n    }\n    onChange(newValue);\n\n    // Set cursor position after formatting\n    setTimeout(() => {\n      textarea.selectionStart = textarea.selectionEnd = newCursorPos;\n      textarea.focus();\n    }, 0);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-editor-wrapper\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-toolbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: () => applyFormat('bold'),\n        title: \"Bold (Ctrl+B)\",\n        className: \"format-button\",\n        children: /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: () => applyFormat('bullet'),\n        title: \"Bullet List\",\n        className: \"format-button\",\n        children: \"\\u2022\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: () => applyFormat('number'),\n        title: \"Numbered List\",\n        className: \"format-button\",\n        children: \"1.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n      ref: textareaRef,\n      className: \"simple-textarea\",\n      value: value || '',\n      onChange: handleChange,\n      onKeyDown: e => {\n        handleKeyDown(e);\n        // Add keyboard shortcuts\n        if (e.ctrlKey && e.key === 'b') {\n          e.preventDefault();\n          applyFormat('bold');\n        }\n      },\n      placeholder: placeholder,\n      style: {\n        minHeight: height\n      },\n      dir: \"ltr\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 148,\n    columnNumber: 5\n  }, this);\n};\n_s(SimpleTextEditor, \"gJtT2aPnbUb4WH8ANBrFCKASbhs=\");\n_c = SimpleTextEditor;\nconst PhotographyService = ({\n  vendorId,\n  isReadOnly\n}) => {\n  _s2();\n  const [isEditing, setIsEditing] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [photos, setPhotos] = useState([]);\n  const [uploading, setUploading] = useState(false);\n  const [toast, setToast] = useState(null);\n  const toastTimeout = useRef(null);\n  const [formData, setFormData] = useState({\n    service_description: '',\n    camera_specs: '',\n    base_rate: '',\n    additional_rates: ''\n  });\n\n  // Show toast notification\n  const showToast = (message, type = 'info') => {\n    if (toastTimeout.current) {\n      clearTimeout(toastTimeout.current);\n    }\n    setToast({\n      message,\n      type\n    });\n    toastTimeout.current = setTimeout(() => {\n      setToast(null);\n      toastTimeout.current = null;\n    }, 5000);\n  };\n\n  // Close toast manually\n  const closeToast = () => {\n    if (toastTimeout.current) {\n      clearTimeout(toastTimeout.current);\n      toastTimeout.current = null;\n    }\n    setToast(null);\n  };\n\n  // Cleanup timeout on unmount\n  useEffect(() => {\n    return () => {\n      if (toastTimeout.current) {\n        clearTimeout(toastTimeout.current);\n      }\n    };\n  }, []);\n\n  // Function to fetch portfolio photos\n  const fetchPortfolioPhotos = useCallback(async vendorId => {\n    try {\n      // Get the current user's ID\n      const {\n        data: {\n          user\n        }\n      } = await supabase.auth.getUser();\n      if (!user) {\n        console.log('No user logged in');\n        setPhotos([]);\n        return;\n      }\n      console.log('Fetching photos for user:', user.id);\n\n      // List all files in the user's folder with pagination\n      let allFiles = [];\n      let hasMore = true;\n      let offset = 0;\n      const limit = 100; // Max files per request\n\n      while (hasMore) {\n        const {\n          data,\n          error\n        } = await supabase.storage.from('portfolio-photos').list(user.id, {\n          limit,\n          offset,\n          sortBy: {\n            column: 'created_at',\n            order: 'desc'\n          } // Newest first\n        });\n        if (error) throw error;\n        if (data && data.length > 0) {\n          // Filter out any non-image files\n          const imageFiles = data.filter(file => file.name.match(/\\.(jpg|jpeg|png|gif|webp)$/i));\n          allFiles = [...allFiles, ...imageFiles];\n\n          // If we got fewer files than the limit, we've reached the end\n          if (data.length < limit) {\n            hasMore = false;\n          } else {\n            offset += limit;\n          }\n        } else {\n          hasMore = false;\n        }\n      }\n      console.log(`Found ${allFiles.length} photos`);\n\n      // Get public URLs for all files\n      const photoUrls = await Promise.all(allFiles.map(async file => {\n        try {\n          const {\n            data: {\n              publicUrl\n            }\n          } = supabase.storage.from('portfolio-photos').getPublicUrl(`${user.id}/${file.name}`);\n          console.log('Generated URL for:', file.name);\n          return publicUrl;\n        } catch (err) {\n          console.error('Error generating URL for', file.name, err);\n          return null;\n        }\n      }));\n\n      // Filter out any null values and update state\n      const validUrls = photoUrls.filter(url => url !== null);\n      console.log(`Successfully loaded ${validUrls.length} photo URLs`);\n      setPhotos(validUrls);\n    } catch (error) {\n      console.error('Error fetching portfolio photos:', error);\n      showToast(`Error loading photos: ${error.message}`, 'error');\n      setPhotos([]);\n    }\n  }, []);\n\n  // Function to fetch photography data\n  const fetchPhotographyData = useCallback(async () => {\n    try {\n      setIsLoading(true);\n      const {\n        data,\n        error\n      } = await supabase.from('vendor_services').select('*').eq('vendor_id', vendorId).eq('service_type', 'photography').single();\n      if (error) {\n        // If no record exists yet, initialize with empty form\n        if (error.code === 'PGRST116') {\n          setFormData({\n            service_description: '',\n            camera_specs: '',\n            base_rate: '',\n            additional_rates: ''\n          });\n          return;\n        }\n        throw error;\n      }\n      if (data) {\n        setFormData({\n          service_description: data.service_description || '',\n          camera_specs: data.camera_specs || '',\n          base_rate: data.base_rate || '',\n          additional_rates: data.additional_rates || ''\n        });\n\n        // Fetch portfolio photos\n        await fetchPortfolioPhotos(vendorId);\n      }\n    } catch (error) {\n      console.error('Error fetching photography data:', error);\n      showToast('Error fetching photography data. Please refresh the page.', 'error');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [vendorId, fetchPortfolioPhotos]);\n\n  // Fetch existing photography service data\n  useEffect(() => {\n    fetchPhotographyData();\n  }, [fetchPhotographyData]);\n  const handleChange = (value, name) => {\n    // Ensure base_rate is always treated as a string\n    const sanitizedValue = value || '';\n    setFormData(prev => ({\n      ...prev,\n      [name]: sanitizedValue\n    }));\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    try {\n      console.log('Saving photography data...', formData);\n\n      // Prepare the data to save\n      const dataToSave = {\n        service_description: formData.service_description || null,\n        camera_specs: formData.camera_specs || null,\n        base_rate: formData.base_rate || null,\n        // Now handled as text\n        additional_rates: formData.additional_rates || null,\n        updated_at: new Date().toISOString()\n      };\n\n      // First, check if the record exists\n      const {\n        data: existingData,\n        error: fetchError\n      } = await supabase.from('vendor_services').select('id').eq('vendor_id', vendorId).eq('service_type', 'photography').maybeSingle();\n      console.log('Existing data check:', {\n        existingData,\n        fetchError\n      });\n      let result;\n      if (fetchError && fetchError.code !== 'PGRST116') {\n        // PGRST116 is 'no rows returned'\n        throw fetchError;\n      }\n      if (existingData) {\n        // Update existing record\n        console.log('Updating existing record:', existingData.id);\n        const {\n          data,\n          error: updateError\n        } = await supabase.from('vendor_services').update(dataToSave).eq('id', existingData.id).select();\n        if (updateError) throw updateError;\n        result = data;\n        console.log('Update result:', result);\n      } else {\n        // Insert new record\n        console.log('Creating new record');\n        const {\n          data,\n          error: insertError\n        } = await supabase.from('vendor_services').insert([{\n          ...dataToSave,\n          vendor_id: vendorId,\n          service_type: 'photography',\n          created_at: new Date().toISOString()\n        }]).select();\n        if (insertError) throw insertError;\n        result = data;\n        console.log('Insert result:', result);\n      }\n      if (result && result.length > 0) {\n        console.log('Save successful, updating UI');\n        setIsEditing(false);\n        // Refresh the data\n        await fetchPhotographyData();\n        showToast('Changes saved successfully!', 'success');\n      } else {\n        throw new Error('No data returned from save operation');\n      }\n    } catch (error) {\n      console.error('Error saving photography data:', error);\n      showToast(`Failed to save changes: ${error.message}`, 'error');\n    }\n  };\n  const handlePhotoUpload = async e => {\n    const file = e.target.files[0];\n    if (!file) return;\n    if (!file.type.startsWith('image/')) {\n      showToast('Please upload an image file', 'error');\n      return;\n    }\n    setUploading(true);\n    try {\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${Math.random().toString(36).substring(2)}.${fileExt}`;\n      const filePath = `vendors/${vendorId}/photography/${fileName}`;\n      const {\n        error: uploadError\n      } = await supabase.storage.from('portfolio-photos').upload(filePath, file);\n      if (uploadError) throw uploadError;\n\n      // Get the public URL\n      const {\n        data: {\n          publicUrl\n        }\n      } = supabase.storage.from('portfolio-photos').getPublicUrl(filePath);\n\n      // Update the photos state with the new photo\n      setPhotos(prev => [...prev, publicUrl]);\n\n      // Reset the file input\n      e.target.value = null;\n      showToast('Photo uploaded successfully!', 'success');\n    } catch (error) {\n      console.error('Error uploading photo:', error);\n      showToast('Error uploading photo. Please try again.', 'error');\n    } finally {\n      setUploading(false);\n      // Reset the file input\n      e.target.value = '';\n    }\n  };\n  const handleDeletePhoto = async photoUrl => {\n    if (!window.confirm('Are you sure you want to delete this photo?')) return;\n    try {\n      // Extract the file path from the public URL.\n      // e.g., .../portfolio-photos/user-id/filename.jpg -> user-id/filename.jpg\n      const url = new URL(photoUrl);\n      const filePath = url.pathname.split('/portfolio-photos/')[1];\n      if (!filePath) {\n        throw new Error('Could not determine file path from URL.');\n      }\n      const {\n        error\n      } = await supabase.storage.from('portfolio-photos').remove([filePath]);\n      if (error) throw error;\n\n      // Update state locally for a faster UI response instead of re-fetching.\n      setPhotos(currentPhotos => currentPhotos.filter(p => p !== photoUrl));\n      showToast('Photo deleted successfully!', 'success');\n    } catch (error) {\n      console.error('Error deleting photo:', error);\n      showToast(`Error deleting photo: ${error.message}`, 'error');\n    }\n  };\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading\",\n      children: \"Loading photography services...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 530,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Toast Notification Component\n  const ToastNotification = () => {\n    if (!toast) return null;\n    const iconMap = {\n      success: /*#__PURE__*/_jsxDEV(FaCheckCircle, {\n        className: \"toast-icon\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 538,\n        columnNumber: 16\n      }, this),\n      error: /*#__PURE__*/_jsxDEV(FaTimesCircle, {\n        className: \"toast-icon\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 539,\n        columnNumber: 14\n      }, this),\n      info: /*#__PURE__*/_jsxDEV(FaInfoCircle, {\n        className: \"toast-icon\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 540,\n        columnNumber: 13\n      }, this)\n    };\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `toast-notification ${toast.type}`,\n      children: [iconMap[toast.type], /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"toast-message\",\n        children: toast.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 546,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: closeToast,\n        className: \"toast-close\",\n        \"aria-label\": \"Close notification\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 547,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 544,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"photography-service\",\n    children: [toast && /*#__PURE__*/_jsxDEV(ToastNotification, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 560,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"service-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"service-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Photography Services\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 563,\n          columnNumber: 11\n        }, this), isEditing ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-actions\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"cancel-button\",\n            onClick: () => {\n              setIsEditing(false);\n              fetchPhotographyData();\n            },\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 566,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"save-button\",\n            form: \"service-form\",\n            children: \"Save Changes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 576,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 565,\n          columnNumber: 13\n        }, this) : !isReadOnly && /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"edit-button\",\n          onClick: () => setIsEditing(true),\n          children: \"Edit Services\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 581,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 562,\n        columnNumber: 9\n      }, this), isEditing ? /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        id: \"service-form\",\n        className: \"service-form\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group rich-text-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Service Description\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 594,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(SimpleTextEditor, {\n            value: formData.service_description,\n            onChange: value => handleChange(value, 'service_description'),\n            placeholder: \"Describe your photography service...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 595,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 593,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group rich-text-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Camera Equipment & Specifications\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 603,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(SimpleTextEditor, {\n            value: formData.camera_specs,\n            onChange: value => handleChange(value, 'camera_specs'),\n            placeholder: \"List your camera equipment and specifications...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 604,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 602,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group rich-text-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Base Rate\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 612,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(SimpleTextEditor, {\n            value: formData.base_rate,\n            onChange: value => handleChange(value, 'base_rate'),\n            placeholder: \"e.g., $100 per hour\",\n            height: \"100px\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 613,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 611,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group rich-text-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Additional Pricing & Packages\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 622,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(SimpleTextEditor, {\n            value: formData.additional_rates,\n            onChange: value => handleChange(value, 'additional_rates'),\n            placeholder: \"List any additional pricing, packages, or special offers...\",\n            height: \"150px\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 623,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 621,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 592,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"service-details\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"service-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Service Description\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 634,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"markdown-content\",\n            \"data-color-mode\": \"light\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"markdown-preview\",\n              children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n                children: formData.service_description || 'No description provided'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 637,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 636,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 635,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 633,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"service-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Camera Equipment & Specifications\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 643,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"markdown-content\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"markdown-preview\",\n              children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n                children: formData.camera_specs || 'No camera specifications provided'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 646,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 645,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 644,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 642,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"service-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Pricing\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 652,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"markdown-content\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pricing-section\",\n              children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                children: \"Base Rate\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 655,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"markdown-preview\",\n                children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n                  children: formData.base_rate || 'No base rate specified.'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 657,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 656,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 654,\n              columnNumber: 17\n            }, this), formData.additional_rates && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pricing-section\",\n              children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                children: \"Additional Rates\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 662,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"markdown-preview\",\n                children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n                  children: formData.additional_rates\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 664,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 663,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 661,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 653,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 651,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 632,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 561,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"service-images\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Portfolio Gallery\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 675,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"portfolio-grid\",\n        children: photos && photos.length > 0 ? photos.map((photo, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"portfolio-photo\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: `${photo}?t=${new Date().getTime()}`,\n            alt: `Portfolio ${index + 1}`,\n            className: \"portfolio-image\",\n            loading: \"lazy\",\n            onError: e => {\n              e.target.onerror = null;\n              e.target.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMCAwIEwgMTAwIDAgTCAxMDAgMTAwIEwgMCAxMDAgWiIgZmlsbD0iI2YwZjBmMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgZmlsbD0iI2NjYyI+RXJyb3I8L3RleHQ+PC9zdmc+';\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 680,\n            columnNumber: 17\n          }, this), isEditing && /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"delete-photo\",\n            onClick: () => handleDeletePhoto(photo),\n            \"aria-label\": \"Delete photo\",\n            children: \"\\xD7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 691,\n            columnNumber: 19\n          }, this)]\n        }, photo, true, {\n          fileName: _jsxFileName,\n          lineNumber: 679,\n          columnNumber: 15\n        }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"no-photos-container\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"no-photos\",\n            children: \"No portfolio photos added yet\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 703,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 702,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 676,\n        columnNumber: 9\n      }, this), isEditing && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"photo-upload\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          id: \"photo-upload\",\n          accept: \"image/*\",\n          onChange: handlePhotoUpload,\n          disabled: uploading,\n          style: {\n            display: 'none'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 710,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"photo-upload\",\n          className: \"upload-button\",\n          children: uploading ? 'Uploading...' : 'Add Photo to Portfolio'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 718,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"upload-hint\",\n          children: \"Upload high-quality images that showcase your best work.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 721,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 709,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 674,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 559,\n    columnNumber: 5\n  }, this);\n};\n_s2(PhotographyService, \"wwnGtBkDTjcBe+NtXHISxczLrPM=\");\n_c2 = PhotographyService;\nexport default PhotographyService;\nvar _c, _c2;\n$RefreshReg$(_c, \"SimpleTextEditor\");\n$RefreshReg$(_c2, \"PhotographyService\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","ReactMarkdown","supabase","FaCheckCircle","FaTimesCircle","FaInfoCircle","jsxDEV","_jsxDEV","SimpleTextEditor","value","onChange","placeholder","height","_s","textareaRef","handleChange","e","target","handleKeyDown","textarea","start","selectionStart","end","selectionEnd","key","preventDefault","shiftKey","beforeCursor","substring","lineStart","lastIndexOf","line","startsWith","newValue","replace","newPos","setTimeout","Math","max","listMatch","match","indent","length","applyFormat","format","current","selectedText","newCursorPos","lines","split","map","i","trim","lineIndent","trimStart","join","itemNumber","numbered","focus","className","children","type","onClick","title","fileName","_jsxFileName","lineNumber","columnNumber","ref","onKeyDown","ctrlKey","style","minHeight","dir","_c","PhotographyService","vendorId","isReadOnly","_s2","isEditing","setIsEditing","isLoading","setIsLoading","photos","setPhotos","uploading","setUploading","toast","setToast","toastTimeout","formData","setFormData","service_description","camera_specs","base_rate","additional_rates","showToast","message","clearTimeout","closeToast","fetchPortfolioPhotos","data","user","auth","getUser","console","log","id","allFiles","hasMore","offset","limit","error","storage","from","list","sortBy","column","order","imageFiles","filter","file","name","photoUrls","Promise","all","publicUrl","getPublicUrl","err","validUrls","url","fetchPhotographyData","select","eq","single","code","sanitizedValue","prev","handleSubmit","dataToSave","updated_at","Date","toISOString","existingData","fetchError","maybeSingle","result","updateError","update","insertError","insert","vendor_id","service_type","created_at","Error","handlePhotoUpload","files","fileExt","pop","random","toString","filePath","uploadError","upload","handleDeletePhoto","photoUrl","window","confirm","URL","pathname","remove","currentPhotos","p","ToastNotification","iconMap","success","info","form","onSubmit","photo","index","src","getTime","alt","loading","onError","onerror","accept","disabled","display","htmlFor","_c2","$RefreshReg$"],"sources":["C:/Users/Ammaarah/EventuallyPerfect/QUANTIX/frontend/src/components/services/PhotographyService.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport { supabase } from '../../client';\r\nimport { FaCheckCircle, FaTimesCircle, FaInfoCircle } from 'react-icons/fa';\r\nimport './PhotographyService.css';\r\n\r\n// Text editor with formatting options\r\nconst SimpleTextEditor = ({ value, onChange, placeholder, height = '150px' }) => {\r\n  const textareaRef = useRef(null);\r\n  \r\n  // Handle text changes\r\n  const handleChange = (e) => {\r\n    onChange(e.target.value);\r\n  };\r\n\r\n  // Handle tab key for indentation\r\n  const handleKeyDown = (e) => {\r\n    const textarea = e.target;\r\n    const start = textarea.selectionStart;\r\n    const end = textarea.selectionEnd;\r\n    \r\n    if (e.key === 'Tab') {\r\n      e.preventDefault();\r\n      \r\n      if (e.shiftKey) {\r\n        // Handle Shift+Tab to decrease indentation\r\n        const beforeCursor = value.substring(0, start);\r\n        const lineStart = beforeCursor.lastIndexOf('\\n') + 1;\r\n        const line = value.substring(lineStart, start);\r\n        \r\n        if (line.startsWith('  ') || line.startsWith('\\t')) {\r\n          // Remove one level of indentation (tab or 2 spaces)\r\n          const newValue = value.substring(0, lineStart) + \r\n                         line.replace(/^(\\s{1,2}|\\t)/, '') + \r\n                         value.substring(start);\r\n          const newPos = start - 1;\r\n          \r\n          onChange(newValue);\r\n          setTimeout(() => {\r\n            textarea.selectionStart = textarea.selectionEnd = Math.max(lineStart, newPos);\r\n          }, 0);\r\n        }\r\n      } else {\r\n        // Handle Tab to increase indentation\r\n        const newValue = value.substring(0, start) + '  ' + value.substring(end);\r\n        onChange(newValue);\r\n        \r\n        // Move cursor after the indentation\r\n        setTimeout(() => {\r\n          textarea.selectionStart = textarea.selectionEnd = start + 2;\r\n        }, 0);\r\n      }\r\n    } else if (e.key === 'Enter') {\r\n      // Handle Enter key to maintain list indentation\r\n      const beforeCursor = value.substring(0, start);\r\n      const lineStart = beforeCursor.lastIndexOf('\\n') + 1;\r\n      const line = value.substring(lineStart, start);\r\n      \r\n      // Check if we're in a list item\r\n      const listMatch = line.match(/^(\\s*[-*+]\\s|\\s*\\d+\\.\\s)/);\r\n      if (listMatch) {\r\n        e.preventDefault();\r\n        const indent = listMatch[1] ? listMatch[0] : '';\r\n        const newValue = value.substring(0, start) + '\\n' + indent + value.substring(end);\r\n        const newPos = start + indent.length + 1;\r\n        \r\n        onChange(newValue);\r\n        setTimeout(() => {\r\n          textarea.selectionStart = textarea.selectionEnd = newPos;\r\n        }, 0);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Apply formatting to selected text\r\n  const applyFormat = (format) => {\r\n    const textarea = textareaRef.current;\r\n    if (!textarea) return;\r\n\r\n    const start = textarea.selectionStart;\r\n    const end = textarea.selectionEnd;\r\n    const selectedText = value.substring(start, end);\r\n    const beforeCursor = value.substring(0, start);\r\n    const lineStart = beforeCursor.lastIndexOf('\\n') + 1;\r\n    const line = value.substring(lineStart, start);\r\n    const indent = line.match(/^\\s*/)[0] || '';\r\n    \r\n    let newValue = value;\r\n    let newCursorPos = end;\r\n\r\n    switch(format) {\r\n      case 'bold':\r\n        newValue = value.substring(0, start) + `**${selectedText}**` + value.substring(end);\r\n        newCursorPos = selectedText ? end + 4 : start + 2;\r\n        break;\r\n        \r\n      case 'bullet':\r\n        if (selectedText) {\r\n          const lines = selectedText.split('\\n')\r\n            .map((line, i) => {\r\n              if (!line.trim()) return '';\r\n              const lineIndent = line.match(/^\\s*/)[0];\r\n              return `${lineIndent}- ${line.trimStart()}`;\r\n            })\r\n            .join('\\n');\r\n          newValue = value.substring(0, start) + lines + value.substring(end);\r\n          newCursorPos = end + (lines.length - selectedText.length);\r\n        } else {\r\n          newValue = value.substring(0, start) + `${indent}- ` + value.substring(start);\r\n          newCursorPos = start + indent.length + 2;\r\n        }\r\n        break;\r\n        \r\n      case 'number':\r\n        if (selectedText) {\r\n          let itemNumber = 1;\r\n          const lines = selectedText.split('\\n')\r\n            .map((line, i) => {\r\n              if (!line.trim()) return '';\r\n              const lineIndent = line.match(/^\\s*/)[0];\r\n              const numbered = `${lineIndent}${itemNumber}. ${line.trimStart()}`;\r\n              itemNumber++;\r\n              return numbered;\r\n            })\r\n            .join('\\n');\r\n          newValue = value.substring(0, start) + lines + value.substring(end);\r\n          newCursorPos = end + (lines.length - selectedText.length);\r\n        } else {\r\n          newValue = value.substring(0, start) + `${indent}1. ` + value.substring(start);\r\n          newCursorPos = start + indent.length + 3;\r\n        }\r\n        break;\r\n        \r\n      default:\r\n        return;\r\n    }\r\n\r\n    onChange(newValue);\r\n    \r\n    // Set cursor position after formatting\r\n    setTimeout(() => {\r\n      textarea.selectionStart = textarea.selectionEnd = newCursorPos;\r\n      textarea.focus();\r\n    }, 0);\r\n  };\r\n\r\n  return (\r\n    <div className=\"text-editor-wrapper\">\r\n      <div className=\"editor-toolbar\">\r\n        <button \r\n          type=\"button\" \r\n          onClick={() => applyFormat('bold')} \r\n          title=\"Bold (Ctrl+B)\"\r\n          className=\"format-button\"\r\n        >\r\n          <strong>B</strong>\r\n        </button>\r\n        <button \r\n          type=\"button\" \r\n          onClick={() => applyFormat('bullet')} \r\n          title=\"Bullet List\"\r\n          className=\"format-button\"\r\n        >\r\n          â€¢\r\n        </button>\r\n        <button \r\n          type=\"button\" \r\n          onClick={() => applyFormat('number')} \r\n          title=\"Numbered List\"\r\n          className=\"format-button\"\r\n        >\r\n          1.\r\n        </button>\r\n      </div>\r\n      <textarea\r\n        ref={textareaRef}\r\n        className=\"simple-textarea\"\r\n        value={value || ''}\r\n        onChange={handleChange}\r\n        onKeyDown={(e) => {\r\n          handleKeyDown(e);\r\n          // Add keyboard shortcuts\r\n          if (e.ctrlKey && e.key === 'b') {\r\n            e.preventDefault();\r\n            applyFormat('bold');\r\n          }\r\n        }}\r\n        placeholder={placeholder}\r\n        style={{ minHeight: height }}\r\n        dir=\"ltr\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst PhotographyService = ({ vendorId, isReadOnly }) => {\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [photos, setPhotos] = useState([]);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [toast, setToast] = useState(null);\r\n  const toastTimeout = useRef(null);\r\n  \r\n  const [formData, setFormData] = useState({\r\n    service_description: '',\r\n    camera_specs: '',\r\n    base_rate: '',  \r\n    additional_rates: ''\r\n  });\r\n\r\n  // Show toast notification\r\n  const showToast = (message, type = 'info') => {\r\n    if (toastTimeout.current) {\r\n      clearTimeout(toastTimeout.current);\r\n    }\r\n    \r\n    setToast({ message, type });\r\n    \r\n    toastTimeout.current = setTimeout(() => {\r\n      setToast(null);\r\n      toastTimeout.current = null;\r\n    }, 5000);\r\n  };\r\n\r\n  // Close toast manually\r\n  const closeToast = () => {\r\n    if (toastTimeout.current) {\r\n      clearTimeout(toastTimeout.current);\r\n      toastTimeout.current = null;\r\n    }\r\n    setToast(null);\r\n  };\r\n\r\n  // Cleanup timeout on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (toastTimeout.current) {\r\n        clearTimeout(toastTimeout.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Function to fetch portfolio photos\r\n  const fetchPortfolioPhotos = useCallback(async (vendorId) => {\r\n    try {\r\n      // Get the current user's ID\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        console.log('No user logged in');\r\n        setPhotos([]);\r\n        return;\r\n      }\r\n\r\n      console.log('Fetching photos for user:', user.id);\r\n      \r\n      // List all files in the user's folder with pagination\r\n      let allFiles = [];\r\n      let hasMore = true;\r\n      let offset = 0;\r\n      const limit = 100; // Max files per request\r\n      \r\n      while (hasMore) {\r\n        const { data, error } = await supabase.storage\r\n          .from('portfolio-photos')\r\n          .list(user.id, {\r\n            limit,\r\n            offset,\r\n            sortBy: { column: 'created_at', order: 'desc' } // Newest first\r\n          });\r\n        \r\n        if (error) throw error;\r\n        \r\n        if (data && data.length > 0) {\r\n          // Filter out any non-image files\r\n          const imageFiles = data.filter(file => \r\n            file.name.match(/\\.(jpg|jpeg|png|gif|webp)$/i)\r\n          );\r\n          allFiles = [...allFiles, ...imageFiles];\r\n          \r\n          // If we got fewer files than the limit, we've reached the end\r\n          if (data.length < limit) {\r\n            hasMore = false;\r\n          } else {\r\n            offset += limit;\r\n          }\r\n        } else {\r\n          hasMore = false;\r\n        }\r\n      }\r\n      \r\n      console.log(`Found ${allFiles.length} photos`);\r\n      \r\n      // Get public URLs for all files\r\n      const photoUrls = await Promise.all(\r\n        allFiles.map(async (file) => {\r\n          try {\r\n            const { data: { publicUrl } } = supabase.storage\r\n              .from('portfolio-photos')\r\n              .getPublicUrl(`${user.id}/${file.name}`);\r\n            console.log('Generated URL for:', file.name);\r\n            return publicUrl;\r\n          } catch (err) {\r\n            console.error('Error generating URL for', file.name, err);\r\n            return null;\r\n          }\r\n        })\r\n      );\r\n      \r\n      // Filter out any null values and update state\r\n      const validUrls = photoUrls.filter(url => url !== null);\r\n      console.log(`Successfully loaded ${validUrls.length} photo URLs`);\r\n      setPhotos(validUrls);\r\n      \r\n    } catch (error) {\r\n      console.error('Error fetching portfolio photos:', error);\r\n      showToast(`Error loading photos: ${error.message}`, 'error');\r\n      setPhotos([]);\r\n    }\r\n  }, []);\r\n\r\n  // Function to fetch photography data\r\n  const fetchPhotographyData = useCallback(async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('vendor_services')\r\n        .select('*')\r\n        .eq('vendor_id', vendorId)\r\n        .eq('service_type', 'photography')\r\n        .single();\r\n\r\n      if (error) {\r\n        // If no record exists yet, initialize with empty form\r\n        if (error.code === 'PGRST116') {\r\n          setFormData({\r\n            service_description: '',\r\n            camera_specs: '',\r\n            base_rate: '',\r\n            additional_rates: ''\r\n          });\r\n          return;\r\n        }\r\n        throw error;\r\n      }\r\n\r\n      if (data) {\r\n        setFormData({\r\n          service_description: data.service_description || '',\r\n          camera_specs: data.camera_specs || '',\r\n          base_rate: data.base_rate || '',\r\n          additional_rates: data.additional_rates || ''\r\n        });\r\n        \r\n        // Fetch portfolio photos\r\n        await fetchPortfolioPhotos(vendorId);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching photography data:', error);\r\n      showToast('Error fetching photography data. Please refresh the page.', 'error');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [vendorId, fetchPortfolioPhotos]);\r\n\r\n  // Fetch existing photography service data\r\n  useEffect(() => {\r\n    fetchPhotographyData();\r\n  }, [fetchPhotographyData]);\r\n\r\n  const handleChange = (value, name) => {\r\n    // Ensure base_rate is always treated as a string\r\n    const sanitizedValue = value || '';\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: sanitizedValue\r\n    }));\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      console.log('Saving photography data...', formData);\r\n      \r\n      // Prepare the data to save\r\n      const dataToSave = {\r\n        service_description: formData.service_description || null,\r\n        camera_specs: formData.camera_specs || null,\r\n        base_rate: formData.base_rate || null,  // Now handled as text\r\n        additional_rates: formData.additional_rates || null,\r\n        updated_at: new Date().toISOString()\r\n      };\r\n      \r\n      // First, check if the record exists\r\n      const { data: existingData, error: fetchError } = await supabase\r\n        .from('vendor_services')\r\n        .select('id')\r\n        .eq('vendor_id', vendorId)\r\n        .eq('service_type', 'photography')\r\n        .maybeSingle();\r\n\r\n      console.log('Existing data check:', { existingData, fetchError });\r\n\r\n      let result;\r\n      \r\n      if (fetchError && fetchError.code !== 'PGRST116') { // PGRST116 is 'no rows returned'\r\n        throw fetchError;\r\n      }\r\n\r\n      if (existingData) {\r\n        // Update existing record\r\n        console.log('Updating existing record:', existingData.id);\r\n        const { data, error: updateError } = await supabase\r\n          .from('vendor_services')\r\n          .update(dataToSave)\r\n          .eq('id', existingData.id)\r\n          .select();\r\n          \r\n        if (updateError) throw updateError;\r\n        result = data;\r\n        console.log('Update result:', result);\r\n      } else {\r\n        // Insert new record\r\n        console.log('Creating new record');\r\n        const { data, error: insertError } = await supabase\r\n          .from('vendor_services')\r\n          .insert([\r\n            {\r\n              ...dataToSave,\r\n              vendor_id: vendorId,\r\n              service_type: 'photography',\r\n              created_at: new Date().toISOString()\r\n            }\r\n          ])\r\n          .select();\r\n          \r\n        if (insertError) throw insertError;\r\n        result = data;\r\n        console.log('Insert result:', result);\r\n      }\r\n\r\n      if (result && result.length > 0) {\r\n        console.log('Save successful, updating UI');\r\n        setIsEditing(false);\r\n        // Refresh the data\r\n        await fetchPhotographyData();\r\n        showToast('Changes saved successfully!', 'success');\r\n      } else {\r\n        throw new Error('No data returned from save operation');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving photography data:', error);\r\n      showToast(`Failed to save changes: ${error.message}`, 'error');\r\n    }\r\n  };\r\n\r\n  const handlePhotoUpload = async (e) => {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n\r\n    if (!file.type.startsWith('image/')) {\r\n      showToast('Please upload an image file', 'error');\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n\r\n    try {\r\n      const fileExt = file.name.split('.').pop();\r\n      const fileName = `${Math.random().toString(36).substring(2)}.${fileExt}`;\r\n      const filePath = `vendors/${vendorId}/photography/${fileName}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from('portfolio-photos')\r\n        .upload(filePath, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      // Get the public URL\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from('portfolio-photos')\r\n        .getPublicUrl(filePath);\r\n\r\n      // Update the photos state with the new photo\r\n      setPhotos(prev => [...prev, publicUrl]);\r\n      \r\n      // Reset the file input\r\n      e.target.value = null;\r\n      \r\n      showToast('Photo uploaded successfully!', 'success');\r\n    } catch (error) {\r\n      console.error('Error uploading photo:', error);\r\n      showToast('Error uploading photo. Please try again.', 'error');\r\n    } finally {\r\n      setUploading(false);\r\n      // Reset the file input\r\n      e.target.value = '';\r\n    }\r\n  };\r\n\r\n  const handleDeletePhoto = async (photoUrl) => {\r\n    if (!window.confirm('Are you sure you want to delete this photo?')) return;\r\n    \r\n    try {\r\n      // Extract the file path from the public URL.\r\n      // e.g., .../portfolio-photos/user-id/filename.jpg -> user-id/filename.jpg\r\n      const url = new URL(photoUrl);\r\n      const filePath = url.pathname.split('/portfolio-photos/')[1];\r\n\r\n      if (!filePath) {\r\n        throw new Error('Could not determine file path from URL.');\r\n      }\r\n      \r\n      const { error } = await supabase.storage\r\n        .from('portfolio-photos')\r\n        .remove([filePath]);\r\n      \r\n      if (error) throw error;\r\n      \r\n      // Update state locally for a faster UI response instead of re-fetching.\r\n      setPhotos(currentPhotos => currentPhotos.filter(p => p !== photoUrl));\r\n      showToast('Photo deleted successfully!', 'success');\r\n\r\n    } catch (error) {\r\n      console.error('Error deleting photo:', error);\r\n      showToast(`Error deleting photo: ${error.message}`, 'error');\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return <div className=\"loading\">Loading photography services...</div>;\r\n  }\r\n\r\n  // Toast Notification Component\r\n  const ToastNotification = () => {\r\n    if (!toast) return null;\r\n\r\n    const iconMap = {\r\n      success: <FaCheckCircle className=\"toast-icon\" />,\r\n      error: <FaTimesCircle className=\"toast-icon\" />,\r\n      info: <FaInfoCircle className=\"toast-icon\" />\r\n    };\r\n\r\n    return (\r\n      <div className={`toast-notification ${toast.type}`}>\r\n        {iconMap[toast.type]}\r\n        <span className=\"toast-message\">{toast.message}</span>\r\n        <button \r\n          onClick={closeToast}\r\n          className=\"toast-close\"\r\n          aria-label=\"Close notification\"\r\n        >\r\n          &times;\r\n        </button>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"photography-service\">\r\n      {toast && <ToastNotification />}\r\n      <div className=\"service-content\">\r\n        <div className=\"service-header\">\r\n          <h3>Photography Services</h3>\r\n          {isEditing ? (\r\n            <div className=\"form-actions\">\r\n              <button\r\n                type=\"button\"\r\n                className=\"cancel-button\"\r\n                onClick={() => {\r\n                  setIsEditing(false);\r\n                  fetchPhotographyData();\r\n                }}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button type=\"submit\" className=\"save-button\" form=\"service-form\">\r\n                Save Changes\r\n              </button>\r\n            </div>\r\n          ) : !isReadOnly && (\r\n            <button\r\n              type=\"button\"\r\n              className=\"edit-button\"\r\n              onClick={() => setIsEditing(true)}\r\n            >\r\n              Edit Services\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        {isEditing ? (\r\n          <form onSubmit={handleSubmit} id=\"service-form\" className=\"service-form\">\r\n            <div className=\"form-group rich-text-group\">\r\n              <label>Service Description</label>\r\n              <SimpleTextEditor\r\n                value={formData.service_description}\r\n                onChange={(value) => handleChange(value, 'service_description')}\r\n                placeholder=\"Describe your photography service...\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"form-group rich-text-group\">\r\n              <label>Camera Equipment & Specifications</label>\r\n              <SimpleTextEditor\r\n                value={formData.camera_specs}\r\n                onChange={(value) => handleChange(value, 'camera_specs')}\r\n                placeholder=\"List your camera equipment and specifications...\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"form-group rich-text-group\">\r\n              <label>Base Rate</label>\r\n              <SimpleTextEditor\r\n                value={formData.base_rate}\r\n                onChange={(value) => handleChange(value, 'base_rate')}\r\n                placeholder=\"e.g., $100 per hour\"\r\n                height=\"100px\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"form-group rich-text-group\">\r\n              <label>Additional Pricing & Packages</label>\r\n              <SimpleTextEditor\r\n                value={formData.additional_rates}\r\n                onChange={(value) => handleChange(value, 'additional_rates')}\r\n                placeholder=\"List any additional pricing, packages, or special offers...\"\r\n                height=\"150px\"\r\n              />\r\n            </div>\r\n          </form>\r\n        ) : (\r\n          <div className=\"service-details\">\r\n            <div className=\"service-section\">\r\n              <h4>Service Description</h4>\r\n              <div className=\"markdown-content\" data-color-mode=\"light\">\r\n                <div className=\"markdown-preview\">\r\n                  <ReactMarkdown>{formData.service_description || 'No description provided'}</ReactMarkdown>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"service-section\">\r\n              <h4>Camera Equipment & Specifications</h4>\r\n              <div className=\"markdown-content\">\r\n                <div className=\"markdown-preview\">\r\n                  <ReactMarkdown>{formData.camera_specs || 'No camera specifications provided'}</ReactMarkdown>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"service-section\">\r\n              <h4>Pricing</h4>\r\n              <div className=\"markdown-content\">\r\n                <div className=\"pricing-section\">\r\n                  <h5>Base Rate</h5>\r\n                  <div className=\"markdown-preview\">\r\n                    <ReactMarkdown>{formData.base_rate || 'No base rate specified.'}</ReactMarkdown>\r\n                  </div>\r\n                </div>\r\n                {formData.additional_rates && (\r\n                  <div className=\"pricing-section\">\r\n                    <h5>Additional Rates</h5>\r\n                    <div className=\"markdown-preview\">\r\n                      <ReactMarkdown>{formData.additional_rates}</ReactMarkdown>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"service-images\">\r\n        <h4>Portfolio Gallery</h4>\r\n        <div className=\"portfolio-grid\">\r\n          {photos && photos.length > 0 ? (\r\n            photos.map((photo, index) => (\r\n              <div key={photo} className=\"portfolio-photo\">\r\n                <img\r\n                  src={`${photo}?t=${new Date().getTime()}`}\r\n                  alt={`Portfolio ${index + 1}`}\r\n                  className=\"portfolio-image\"\r\n                  loading=\"lazy\"\r\n                  onError={(e) => {\r\n                    e.target.onerror = null;\r\n                    e.target.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMCAwIEwgMTAwIDAgTCAxMDAgMTAwIEwgMCAxMDAgWiIgZmlsbD0iI2YwZjBmMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgZmlsbD0iI2NjYyI+RXJyb3I8L3RleHQ+PC9zdmc+';\r\n                  }}\r\n                />\r\n                {isEditing && (\r\n                  <button\r\n                    className=\"delete-photo\"\r\n                    onClick={() => handleDeletePhoto(photo)}\r\n                    aria-label=\"Delete photo\"\r\n                  >\r\n                    &times;\r\n                  </button>\r\n                )}\r\n              </div>\r\n            ))\r\n          ) : (\r\n            <div className=\"no-photos-container\">\r\n              <span className=\"no-photos\">No portfolio photos added yet</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {isEditing && (\r\n          <div className=\"photo-upload\">\r\n            <input\r\n              type=\"file\"\r\n              id=\"photo-upload\"\r\n              accept=\"image/*\"\r\n              onChange={handlePhotoUpload}\r\n              disabled={uploading}\r\n              style={{ display: 'none' }}\r\n            />\r\n            <label htmlFor=\"photo-upload\" className=\"upload-button\">\r\n              {uploading ? 'Uploading...' : 'Add Photo to Portfolio'}\r\n            </label>\r\n            <p className=\"upload-hint\">Upload high-quality images that showcase your best work.</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PhotographyService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}